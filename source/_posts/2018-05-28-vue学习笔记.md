---
title: vue学习笔记
date: 2018-05-28 15:47:49
tags: Vue
categories: 技术
---

# vue基本使用

vue是以数据为基础的框架，凡是涉及到数据就交给vue处理。

vue的使用其实就是一片html代码加上一段js代码即可。

具体步骤如下：

> 引入vue.js文件
> 编写html代码
> 创建Vue对象，并且在其中实现数据、方法等接口

新建的Vue对象代码如下：

```
new Vue({
	el: '#box',
	data: {
		item1: '...',
		item2: true,
		item3: 59,
		item4: ['apple', 'banana'],
		item5: [
			{name: 'Tom', age: '21'},
			{name: 'John', age: '23'}
		]
	},
	methods: {
		example: function(){ ... }
	},
})

//html代码
<div id="box">
	{{item3}}
</div>
```
其中，el选项就是选择器，可以是id选择器、class选择器或标签选择器等。它决定了这个Vue对象中的数据可以在哪里使用。

# 常用指令

指令其实就是对于html标签属性的扩展。

## v-model

`v-model`用于一般表单元素，最常见的用法是用在input元素上，它实现了双向数据绑定。

## v-for

`v-for`用于循环，格式为`v-for="item in arr"`，或`v-for="item in json"`。

vue1.x版本中，可以使用`{{$index}}`来输出当前item的索引值，2.x版本后想要使用索引要用`v-for="(item, index) in items"`，然后通过index来获取当前元素的索引值。

# 事件

## v-on

绑定一个事件通过`v-on:事件类型`来进行绑定。

以click事件为例，绑定click事件的指令为`v-on:click="method()"`。

这里绑定的事件函数具体实现写在Vue对象中的methods中。

<font color="red">（推荐）`v-on:`可以简写成为`@`</font>

## 获取事件对象

在事件调用的方法中添加参数`$event`，注意，这个写法一点不能变。

然后在Vue对象的`methods`中的对应事件处理方法中，使用一个参数接收该事件处理对象，这个参数名字就随意了。此时该参数可以调用类似`clientX`等属性，这些写法与原生js相同。

## 阻止事件冒泡

事件冒泡的顺序是由内而外的，vue项目中阻止事件冒泡有两种方法。

（1）传入一个`$event`参数，在函数中接收到事件对象后，使用原生js的`event.cancelBubble=true`来阻止事件冒泡
（2）（推荐）使用vue提供的简写方式，比如是一个click事件，写为`@click.stop="函数"`即可阻止事件冒泡

## 默认行为

默认行为比如`a`标签点击后跳转，比如右键点击事件`contextmenu`，点击后不仅触发用户定义的事件，还会弹出右键菜单，此时就需要我们阻止默认行为。vue中阻止事件默认行为有两种方法。

（1）传入一个`$event`参数，在函数中接收到事件对象后，使用原生js的`event.preventDefault();`来阻止默认行为
（2）（推荐）使用vue提供的简写方式，比如是一个右键点击事件`contextmenu`，写为`@contextmenu.prevent="函数"`即可阻止事件默认行为

## 键盘事件

比如`@keydown`，`@keyup`，这两个事件的区别体现在输入框上的现象是，前者在执行事件函数的时候输入内容还没有进入输入框，后者在执行事件函数的时候输入内容已经进入输入框了。

可以通过给事件函数传入事件对象，然后在函数中获取该事件对象的`keyCode`属性来获取该按键的键值。

常用按键，vue提供了一些简写方式：
> 回车键 `@keyup.13`，或者`@keyup.enter`
> 上方向键 `@keyup.up`
> 下方向键 `@keyup.down`
> 左方向键 `@keyup.left`
> 右方向键 `@keyup.right`
> 删除键 `@keyup.delete`
> ....等等

# 一点关于bootstrap的补充

bootstrap是一个依赖于jquery的css框架，它主要使用class和role两个属性。

比如，使用bootstrap声明一个表单，代码如下：
```
<form role="form">
	<div class="form-group">
		<label for="username">用户名</label>
		<input type="text" name="username" class="form-control" placeholder="请输入用户名" v-model="username">
	</div>
	<div class="form-group">
		<label for="age">年 龄</label>
		<input type="text" name="age" class="form-control" placeholder="请输入年龄" v-model="age">
	</div>
	<div class="form-group">
		<input type="button" class="btn btn-primary" value="添加" v-on:click="add()"></input>
		<input type="reset" class="btn btn-danger" value="重置" v-on:click="reset()"></input>
	</div>
</form>
```

再比如，使用bootstrap声明一个模式对话框。

```
<div role="dialog" class="modal fade" id="layer">
	<div class="modal-dialog">
		<div class="modal-content">
			<!-- 对话框的头部 -->
			<div class="modal-header">
				<!-- data-dismiss：关闭模态对话框 -->
				<button class="close" data-dismiss="modal">
					<!-- 这里的&times;是一个html字符 -->
					<span>&times;</span>
				</button>
				<h4 class="modal-title"><strong>提示</strong></h4>
			</div>
			<div class="modal-body">
				<p>确认删除吗？</p>
				<div class="text-right">
					<button data-dismiss="modal" class="btn btn-primary btn-sm">取消</button>
					<button data-dismiss="modal" class="btn btn-danger btn-sm" v-on:click="deleteItem()">确认</button>
				</div>
			</div>
		</div>
	</div>
</div>
```
上面这个模态，在调用它的按钮上声明`data-toggle="modal" data-target="#layer"`即可打开这个对话框。

其中，`data-toggle`设置了以什么事件触发，如`modal`； `data-target`设置了事件的目标，对于本例来说也就是要打开谁。

bootstrap有很多实用的属性，比如`text-center`就是居中，`text-right`就是居右，`text-info`是改变文本的颜色为提示信息的颜色等等。在以后的使用过程中要善于尝试和积累。


# 属性

## v-bind绑定属性

现在假设我们已经在data中声明了一个url的值，此时使用html原生语法`<img src="{{url}}" alt="">`也可以获取到该图片，但是f12控制台会报错，它发送了一个404请求，并建议我们使用`v-bind`。

使用`v-bind`的写法是`<img v-bind:src="url" alt="">`，这是就不会发404请求。

<font color="red">（推荐）`v-bind:`可以简写成为`:`</font>，即上例可以写为`<img :src="url" alt="">`。

下面介绍属性中的两个特例。

## class属性

vue中要绑定class属性的值，有两种方法。

现在我们假定有一个`.red`样式表和一个`.blue`样式表，则要为一个元素绑定class属性，有以下两种写法。

（1）`:class="[red,b]"`，其中，`red`和`b`不是直接对应样式表，而是先找到`data`中的数据。即，`data`中的内容如下：
```
data: {
	red: 'red',
	b: 'blue'
}
```
这样才能最终找到样式表。

（2）也可以使用`:class="{red: true, blue: false}"`这种方式来给`class`属性赋值，此时的`red`和`blue`指的就是样式表中的`red`和`blue`，后边的`true`或`false`指定该样式是否添加到该元素上。

（3）（推荐）第三种方式实际上是第二种方式的改进写法，我们说vue是基于数据的，能够使用数据的地方就要使用数据。指定元素的`class`属性还可以写为`:class="{red: a, blue: b}"`，其中，`a`和`b`是`data`中的数据，`data`具体内容如下：
```
data: {
	a: true,
	b: false
}
```
这时就可以很方便的指定某个样式是否添加到该元素上了。

（4）（推荐）第四种方式又是第三种方式的衍生，第三种方式`class`的值实际上是一个json数据。第四种方式其实就是将这个json数据放到`data`里。也就是指定`class`属性的语句写为`:class="json"`，`data`中写为：
```
data: {
	json: {
		red: true,
		blue: false
	}
}
```

## style

style基本和class相同。
（1）第一种方式也是可以将数据写成数组的形式赋值给`style`，即`:style="[a,b]"`，`a`和`b`在`data`中赋值：
```
data: {
	a: {color: 'red'},
	b: {backgroundColor: 'blue'}
}
```
注意，在js中写复合样式要采用驼峰命名法，即`background-color`写为`backgroundColor`。

（2）（推荐）第二种方式也是可以使用json的形式。即`:style="json"`，data中赋值为：
```
data: {
	json: {
		color: 'red',
		backgroundColor: 'blue'
	}
}
```


# 模板
```
{{ msg }}
```
类似上面的代码就是模板。

有几种形式：
```
{{msg}}			数据更新模板变化
{{*msg}}		数据只绑定一次，数据更新模板不会变化
{{{msg}}}		会执行msg中的HTML代码
```

# 过滤器

用于过滤模板中的数据。

语法：
```
{{msg|filterA [ 参数]}}
{{msg|filterA|filterB}}
```

系统提供了一些过滤器：
```
{{'welcome'|uppercase}}			全部转换为大写字母
{{'WELCOME'|lowercase}}			全部转换为小写字母
{{'welcome'|captalize}}			首字母大写
{{'WELCOME'|lowercase|captalize}}	先转换为小写在首字母大写
{{12|currency}}				将数字转换为美元钱的格式，12会变成`$12.00`
{{12|currency '￥'}}			将数字转换为人民币的格式，12会变成`￥12.00`
{{12|currency 'rmb'}}			将数字转换为人民币的格式，12会变成`rmb12.00`
```

还有很多可以去vue的官方api中查看。


# 交互

注意，这里要启动服务器。

vue如果想做ajax交互，必须下载vue官方的一个库，vue-resource。 引入vue-resource.js文件之后，就会在Vue对象中添加一个`$http`属性。

## get方法

### 获取一个普通文本数据

现在假设与该html文件同目录下有一个`a.txt`文件，现要通过`get`方法获取它里面的数据。首先写明一个html元素，点击它的时候请求`testGet`方法。
具体实现get方法的步骤如下：
```
methods:{
	testGet: function(){
		this.$http.get('a.txt').then(function(res){
			alert('请求成功，请求到的数据是：' + res.data);
		},function(res){
			alert('请求失败，请求返回的状态码是：' + res.status);
		});
	}
}
```

### 给服务器发送数据

```
this.$http.get('请求服务器上的url地址',{
	data1: 1,
	data2: 'test'
}).then(function(res){
	alert('请求成功，请求到的数据是：' + res.data);
},function(res){
	alert('请求失败，请求返回的状态码是：' + res.status);
});
```

## POST方法

```
this.$http.post('请求服务器上的url地址',{
	data1: 1,
	data2: 'test'
},{
	// 这一句也就相当于发送post请求的时候修改post请求头
	emulateJSON:true 
}).then(function(res){
	alert('请求成功，请求到的数据是：' + res.data);
},function(res){
	alert('请求失败，请求返回的状态码是：' + res.status);
});
```

## jsonp

Jsonp(JSON with Padding) 是 json 的一种"使用模式"，可以让网页从别的域名（网站）那获取资料，即跨域读取数据。
这样的话我们就可以请求其他网站的接口。
如果使用jquery框架，然后要使用这种类型的话，会创建一个查询字符串参数`callback=?`，这个参数会加在请求的URL后面。服务器端应当在JSON数据前加上回调函数名，以便完成一个有效的JSONP请求。如果要指定回调函数的参数名来取代默认的`callback`，可以通过设置`$.ajax()`的`jsonp`参数。
而放在我们vue框架中，也是指定一个jsonp的值。

Jquery 在每次跨域发送请求时都会有`callback`这个参数，其实这个参数的值就是回调函数名称，所以，服务器端在发送json数据时，应该把这个参数放到前面，这个参数的值往往是随机生成的，如：`jsonp1294734708682`，同时也可以通过`$.ajax`方法设置`callback`方法的名称。明白了原理后，服务器端应该这样发送数据：
```
string message = "jsonp1294734708682({\"userid\":0,\"username\":\"null\"})";
```

这样，json 数据 `{\"userid\":0,\"username\":\"null\"}`就作为了 `jsonp1294734708682`回调函数的一个参数。

了解了上面的内容过后，就可以来学习vue中如何使用jsonp类型的请求了，具体代码如下。
```
this.$http.jsonp('请求的接口地址',{
	params: {
	  wd:this.searchText
	},
	//比如请求好搜的接口，能正常请求到
	//而如果请求百度的接口这里可能就要设置一些选项了
	//因为好搜的callback没有改名
	//而百度的callback函数改名叫做cb
	jsonp:'cb'
}).then(function(res){
	alert('请求成功，请求到的数据是：' + res.data);
}, function(res){
	alert('请求失败，请求返回的状态码是：' + res.status);
});
```

接口可以在浏览器的控制台NETWORK选项卡中，右键`copy link`来获取接口地址，去掉一些没有的参数就可以拿来使用。

## `$http`方法
`$http`方法就相当于jquery中的`$.ajax()`方法，它默认发送get请求。

```
this.$http({
	url: 请求地址,
	data: 给后台提交的数据,
	method: 指定请求的方法类型,
	jsonp: 'cb' // 原来的jsonp
}).then(successFunction, failFunction);
```





# vue的生命周期

vue提供了一系列钩子函数：

`created` -> 实例创建完毕的时候执行，也就是Vue对象实例化出来之后执行。
`beforeCompile` -> 实例编译之前执行
`compiled` -> 编译之后执行
`ready` -> 真正的把创建的文档节点插入到文档中，也就是最终加载完毕
`beforeDestroy` -> 对象销毁之前
`destroyed` -> 销毁之后

如何销毁对象：使用一个变量`vm`接收`new Vue`创建的对象，使用`vm.$destroy()`来销毁这个实例。

正常来讲ready函数用的比较多。

# 用户看到花括号

vue因为html中使用的都是花括号标记，如果用户网络状态不好，会看到花括号闪烁。
解决办法：
（1）在会闪烁的元素（的父元素）上加上`v-cloak`，用于防止闪烁
（2）在`<style>`标记中，书写以下代码：
```
[v-cloak]{
	display:none;
}
```
上边代码中，`[v-cloak]`表示属性选择器。
`v-cloak`一般会用到一大段里面，也就是用到一个很大的父元素上，但要用于某个标签也是可以的。

另一种思路是，不使用花括号，使用花括号的代替指令`v-text`。

```
<span>{{msg}}</span>

<span v-text="msg"></span>
```
上边代码中的两种表示形式是等价的，而第二种形式能够防止闪烁。

如果要将内容中的html代码编译出来，有以下两种形式：
```
<span>{{{msg}}}</span>

<span v-html="msg"></span>
```
上面代码中第二种形式能够防止闪烁。
需要注意的是，vue2.0中，第一种表示形式已经删掉了。

# 计算属性的使用
下面介绍计算属性`computed`的使用。

`data`中可以放各种类型的属性，但是不能放业务逻辑代码。这时候就可以使用用`computed`计算属性了。

```
data: {
	a: 1
}

computed: {
	b: function(){
		// 可以写一些业务逻辑代码
		return 2;
	}
}
```
上面代码中，b就是一个计算属性，它看起来虽然很像一个函数，但它不是，它是一个属性，使用`{{b}}`即可获取它的值，不需要调用。它的值完全取决于`return`返回值，`return`语句之前可以填写一些逻辑代码。

比如如果想要实现`b`永远比`a`大一，则代码如下：
```
data: {
	a: 1
}

computed: {
	b: function(){
		return this.a+1;
	}
}
```

## get与set

上面的这种写法，默认调用计算属性的`get`方法。此时如果用户对`b`赋值，`vm.b=1`，是完全无效的，因为`b`的`get`方法中的`return`语句指定了`b`的值取决于`a`。

那么如何才能对`b`赋值呢？

可以采用计算属性的另外一种写法：

```
computed:{
	b:{
		get: function(){
			return a+2;
		}
		set: function(val){
			this.a = val;
		}
	}
}
```
上述代码中设置`a`的值是因为只有这样才能改变`b`的值。此时如果调用`vm.b=1`，最后返回的结果里，`a`为`1`，`b`为`3`。

综上所述，`computed`里面可以放置一些业务逻辑代码，一定记得`return`。

# vue实例自带的一些方法

```
var vm = new Vue({
	el: '#box',
	data: {
		a: 1
	}
})
```

`vm.$el` -> 返回el指定的元素
`vm.$data` -> 返回data数据对象，使用`vm.$data.a`可以返回1
`vm.$mount('#box')` -> 手动挂载，有了这句代码，Vue对象中可以不指定`el`
`vm.$options` -> 用于访问Vue对象中自定义的属性
`vm.$destroy` -> 销毁对象
`vm.$log()` -> 用来看data中的数据现在是什么状态，也就是现在的值是什么

因此，创建vue实例还有一种手动挂载的写法：
```
new Vue({
	data: {
		a: 1
	}
}).$mount('#box');
```

访问自定义属性：
```
new Vue({
	aa: 11,
	show: function(){
		alert(1);
	},
	data: {
		a: 1
	}
}).$mount('#box');

// 使用vm.$options.aa对aa的值进行访问
// 使用vm.$options.show来调用show属性指代的函数
```

```
new Vue({
	data: {
		a: 1,
		b: 2
	}
}).$mount('#box');
```
此时如果调用`console.log(vm.$log())`，会打印出来一个`object`，里边是`a`和`b`两个属性。

# 循环

循环有些时候会有重复数据。如果是1.0版本需要使用`track-by`来输出重复属性，2.0版本`v-for`支持重复数据输出了。

```
new Vue({
	data: {
		arr: ['apple','pear','orange']
	},
	methods: {
		add: function(){
			arr.push('tomato');
		}
	}
}).$mount('#box');
```






